---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Lexun Yu
thanks: "Code and data are available at: [https://github.com/yulexun/toronto-fire](https://github.com/yulexun/toronto-fire)."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
toc: true
number-sections: true
bibliography: bibliography.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#### Workspace setup ####
library(tidyverse)
library(tinytex)
library(dplyr)
library(tibble)
library(opendatatoronto)
library(janitor)
library(ggplot2)
library(knitr)
library(here)


# # Set the number of decimal places to 2 for all subsequent figures and tables. 
# # https://github.com/AbbassSleiman/Lead-Concentrations/blob/main/outputs/paper/lead_concentration.qmd
# options(digits = 2)


# Read data, https://stackoverflow.com/questions/78894145/quarto-document-not-seeing-project-directory-for-targets-data-functions-or-scr
raw_data <- read_csv(here("data/raw/toronto_fire_incidents.csv"))
cleaned_data <- read_csv(here("data/analysis/cleaned_fire_data_simple.csv"))
cleaned_data_tfs <-
  cleaned_data |>
  select(
    tfs_alarm_time, 
    tfs_arrival_time, 
    time_diff,
    civilian_casualties, 
    estimated_dollar_loss,
  )
cleaned_data_cat <-
  cleaned_data |>
  select(
    area_of_origin, 
    ignition_source, 
    fire_alarm_system_presence, 
    smoke_alarm_at_fire_origin, 
    sprinkler_system_operation
  )

legend <- read.csv(here("data/legend.txt"), header = TRUE, stringsAsFactors = FALSE)
```


# Introduction {#sec-intro}
The urban fire hazard is one of the most pressing issues in this context, especially in Canada where cities are dealing with such issues like climate, facilities or population density.As of July 1 2023, the population in urban area in Canada reached 33,812,133 [@statsCanada]. 
Not only do fires in highly populated regions result in heavy losses in terms of property, but also, in the contest of people and the environment, the consequences are enormous. Also, urban fires are resources-dependent and require attention from city services and emergency services, thus indicating the need for prevention, action and planning based on risk assessment. With such issues in mind, the knowledge of urban fire hazards in Canadian cities is needed for creating policies that address public safety and increase urban resilience.

In Canada, articles about fire incidents has a focus on wildfire. For instance, @Goemans2012 discuss the fire mitigation plan during the 2003 wildfire at Kelowna, British Columbia, while @Mamuji2018 talk about the evacuation during the Fort McMurray wildfire in Alberta. The researches conducted about urban fire incidents are done in other parts of the world such as East Asia. @MasoodRafi2012 research the nature and level of this threat. They conclude that the lack of training in fire department, shortage of facilities and infrastructure the major issues in Pakistan. The research by @HariMurti2023 in Semarang City also emphasize the importance of community understanding and the installation of fire protection facilities. This article uses the data provided by opendatatoronto library [@opendatatoronto] in order to analyze fire occurrences in the city of Toronto, which is an important research gap in the study of fire incidents in America. This study seeks to provide a deeper understanding of fire patterns to improve fire prevention and emergency response strategies.

In this paper we visualize Toronto's Fire Incidents' data. 

# Data

## Raw Data
This project uses @citeR, @opendatatoronto, @knitr, @tidyverse, @ggplot2, @dplyr

## Cleaned Data

```{r}
#| echo: false
#| 
# Convert str to factor

cleaned_data_cat <-
  cleaned_data_cat %>%
  mutate_at(vars(
    area_of_origin,
    fire_alarm_system_presence, ignition_source,
    smoke_alarm_at_fire_origin, sprinkler_system_operation
  ), as.factor)
```

```{r}
#| label: table-clean-tfs
#| tbl-cap: Top rows of cleaned Toronto Fire Service response time and loss data
#| echo: false

head(cleaned_data_tfs, 5) |>
  kable(
    col.names = c("Alarm Time", "TFS Arrival Time", "TFS Response Time"
    , "Civilian Casualties", "Estimated Loss in Dollar"),
      )
```

```{r}
#| label: table-clean-cat
#| tbl-cap: Top rows of cleaned data showing Area of Origin, Ignition source and Fire, Smoke, Sprnkler System Presence.
#| echo: false

head(cleaned_data_cat, 5) |>
  kable(
    col.names = c("Area of Origin", "Ignition Source", "Fire Alarm Status"
    , "Smoke Alarm Status", "Sprinkler System Status"),
      )
cat("Note: 'PO' = System present, \n'N' = System not present, \n'P' = System present but not operated")
```

\newpage

\appendix

# Appendix {#sec-appendix}

## Graph of areas of origin of fire incidents by number of occurrences {#sec-origin-fig}
```{r, fig.width=10,fig.height=11}
#| label: fig-origin
#| fig-cap: Areas of origin of fire incidents by number of occurrences
#| echo: false

cleaned_data_cat |>
  count(area_of_origin) |>
  ggplot(mapping = aes(x = n, y = area_of_origin)) +
  geom_col() + 
  theme_minimal() + 
  labs(x = "number of observation", y = "area of origin")

cat("Index of 'Area of Origin':")
cat(legend$x, sep = "\n")
```

# Attribution Statement
Contains information licensed under the Open Government Licence â€“ Toronto. 
Visit: [https://open.toronto.ca/open-data-license/](https://open.toronto.ca/open-data-license/)

\newpage
# Bibliography
